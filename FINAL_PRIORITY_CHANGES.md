# ‚úÖ –ò–ó–ú–ï–ù–ï–ù–ò–ï –ü–†–ò–û–†–ò–¢–ï–¢–ê –ó–ê–í–ï–†–®–ï–ù–û

## üìù –ò–ó–ú–ï–ù–Å–ù–ù–´–ô –§–ê–ô–õ

**–§–∞–π–ª:** `shared/src/rtl433_asn1_pulse.c`  
**–§—É–Ω–∫—Ü–∏—è:** `prepare_pulse_data()` (—Å—Ç—Ä–æ–∫–∏ 516-604)

---

## üîÑ –ß–¢–û –ò–ó–ú–ï–ù–ò–õ–û–°–¨

### –ë—ã–ª–æ (hex_string –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç):
```c
// 1. –ó–∞–ø–æ–ª–Ω–∏—Ç—å pulses array
// 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å hex_string ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è SignalData
// 3. Fallback –Ω–∞ pulses array

if (hex_string) {
    signal_msg->signalData = hexString;      // ‚ùå –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç hex_string (~9%)
} else {
    signal_msg->signalData = pulsesArray;
}
```

### –°—Ç–∞–ª–æ (pulses array –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç):
```c
// ‚úÖ –ü–†–ò–û–†–ò–¢–ï–¢ 1: pulses array (–µ—Å–ª–∏ num_pulses > 0)
if (pulse->num_pulses > 0) {
    // –ó–∞–ø–æ–ª–Ω–∏—Ç—å pulses array
    signal_msg->signalData = pulsesArray;    // ‚úÖ 100% —Ç–æ—á–Ω–æ—Å—Ç—å
}
// ‚ö†Ô∏è –ü–†–ò–û–†–ò–¢–ï–¢ 2: hex_string (fallback)
else if (hex_string) {
    signal_msg->signalData = hexString;      // ~9% —Ç–æ—á–Ω–æ—Å—Ç—å
}
// ‚ö†Ô∏è –ü–†–ò–û–†–ò–¢–ï–¢ 3: –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
else {
    signal_msg->signalData = pulsesArray;    // –ü—É—Å—Ç–æ–π
}
```

---

## ‚úÖ –ü–û–ß–ï–ú–£ –î–ï–ö–û–î–ò–†–û–í–ê–ù–ò–ï –ù–ï –ò–ó–ú–ï–ù–Ø–õ–û–°–¨?

**–í ASN.1 —Å—Ö–µ–º–µ `SignalData` —ç—Ç–æ CHOICE (–≤—ã–±–æ—Ä):**
```asn1
SignalData ::= CHOICE {
    hexString OCTET STRING,
    hexStrings SEQUENCE OF OCTET STRING,
    pulsesArray PulsesData
}
```

**CHOICE –æ–∑–Ω–∞—á–∞–µ—Ç:**
- –ú–æ–∂–µ—Ç –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å **–¢–û–õ–¨–ö–û –û–î–ù–û** –ø–æ–ª–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –ü—Ä–∏ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è —Ç–æ, —á—Ç–æ –µ—Å—Ç—å
- –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫ **–Ω–µ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è**

**–ü–æ—ç—Ç–æ–º—É –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω—É–∂–Ω—ã —Ç–æ–ª—å–∫–æ –≤ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–∏**, –≥–¥–µ –º—ã **–≤—ã–±–∏—Ä–∞–µ–º**, –∫–∞–∫–æ–µ –ø–æ–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢

### –¢–æ—á–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:

| –ú–µ—Ç–æ–¥ | –¢–æ—á–Ω–æ—Å—Ç—å | Toyota TPMS |
|-------|----------|-------------|
| **pulses array** | ‚úÖ **100%** | ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç** |
| **hex_string** | ‚ùå ~9% | ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç |

### –ü—Ä–∏–º–µ—Ä:

**–û—Ä–∏–≥–∏–Ω–∞–ª:**
```
[40, 60, 40, 64, 40, 52, 52, 96, 200, 104, ...]
```

**–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ (pulses array):**
```
[40, 60, 40, 64, 40, 52, 52, 96, 200, 104, ...]  ‚úÖ 100% —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
```

**–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ (hex_string):**
```
[48, 48, 48, 48, 200, 96, 48, 48, ...]  ‚ùå ~9% —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
```

---

## üéØ –ö–û–ù–°–û–õ–¨–ù–´–ô –í–´–í–û–î

### –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ—Ç–ø—Ä–∞–≤–∫–∞):

**–° pulses array:**
```
‚úÖ PRIORITY 1: Using EXACT pulses array (58 pulses) for SignalData
üì¶ Added 58 pulses to SignalData (pulsesArray)
```

**–ë–µ–∑ pulses (—Ç–æ–ª—å–∫–æ hex_string):**
```
‚ö†Ô∏è PRIORITY 2: FALLBACK to hex_string (no pulses available)
üì¶ Using hexString for single signal
```

### –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø–æ–ª—É—á–µ–Ω–∏–µ):

```
üì¶ Extracting 58 pulses from SignalData
üì° Extracted sample rate: 250000 Hz
üìä Extracted fsk_f1_est: 5951
üìä Extracted fsk_f2_est: -10916
```

---

## ‚úÖ –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê

1. **100% —Ç–æ—á–Ω–æ—Å—Ç—å** –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—É–ª—å—Å–æ–≤
2. **Toyota TPMS** –∏ –¥—Ä—É–≥–∏–µ —Å–ª–æ–∂–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –±—É–¥—É—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã
3. **Backward compatibility** —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ (hex_string –∫–∞–∫ fallback)
4. **FSK metadata** (fsk_f1_est, fsk_f2_est) —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –¢–µ—Å—Ç 1: –° pulses array
```bash
cd build
./rtl_433_client -F asn1://localhost/rtl_433 -Q 1
# –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–∏–≥–Ω–∞–ª —Å pulses array
# ‚úÖ –û–∂–∏–¥–∞–µ—Ç—Å—è: Toyota TPMS detected
```

### –¢–µ—Å—Ç 2: –ë–µ–∑ pulses (fallback)
```bash
# –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–∏–≥–Ω–∞–ª —Ç–æ–ª—å–∫–æ —Å hex_string
# ‚ö†Ô∏è –û–∂–∏–¥–∞–µ—Ç—Å—è: FALLBACK to hex_string
# ‚ùå Toyota TPMS NOT detected
```

---

## üì¶ –°–õ–ï–î–£–Æ–©–ò–ô –®–ê–ì

**–ö–æ–º–ø–∏–ª—è—Ü–∏—è:**
```bash
cd build
make rtl_433_client -j4
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å rtl_433 —Å —Ä–µ–∞–ª—å–Ω—ã–º —Å–∏–≥–Ω–∞–ª–æ–º Toyota TPMS
./rtl_433_client -F asn1://localhost/rtl_433 -Q 1 < toyota_signal.json
```

---

## ‚úÖ –°–¢–ê–¢–£–°: –ì–û–¢–û–í–û

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤–Ω–µ—Å–µ–Ω—ã —Ç–æ–ª—å–∫–æ –≤ —Ñ—É–Ω–∫—Ü–∏—é `prepare_pulse_data()`**  
**–î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –∏–∑–º–µ–Ω—è–ª–æ—Å—å (CHOICE - –∏–∑–ª–∏—à–Ω–µ)**  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: pulses array ‚Üí hex_string** ‚úÖ






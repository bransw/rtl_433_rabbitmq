# –ê–Ω–∞–ª–∏–∑: –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ hex_string –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è Toyota TPMS?

## üì° –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–µ–∫–æ–¥–µ—Ä–∞ Toyota TPMS (–∏–∑ tpms_toyota.c)

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

```c
r_device const tpms_toyota = {
    .name        = "Toyota TPMS",
    .modulation  = FSK_PULSE_PCM,        // ‚úÖ FSK –º–æ–¥—É–ª—è—Ü–∏—è
    .short_width = 52,                   // ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û! 12-13 samples @250k
    .long_width  = 52,                   // ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û! FSK
    .reset_limit = 150,                  // ‚ö†Ô∏è –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π gap –ø–µ—Ä–µ–¥ End Of Message
    .decode_fn   = &tpms_toyota_callback,
};
```

### –ü—Ä–æ—Ü–µ—Å—Å –¥–µ—Ç–µ–∫—Ü–∏–∏:

1. **–ü–æ–∏—Å–∫ –ø—Ä–µ–∞–º–±—É–ª—ã**: `0xa9, 0xe0` (12 bits = `10101001 11100000`)
   - –¢—Ä–µ–±—É–µ—Ç **—Ç–æ—á–Ω–æ–≥–æ** –±–∏—Ç–æ–≤–æ–≥–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `bitbuffer_search()` - —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∫ –æ—à–∏–±–∫–∞–º

2. **–î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ Differential Manchester**:
   - –ö–∞–∂–¥—ã–π –±–∏—Ç –∫–æ–¥–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ **–ø–µ—Ä–µ—Ö–æ–¥** (01 –∏–ª–∏ 10)
   - –¢—Ä–µ–±—É–µ—Ç **—Å—Ç–∞–±–∏–ª—å–Ω–æ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** –ø—É–ª—å—Å–æ–≤
   - –û–∂–∏–¥–∞–µ—Ç—Å—è: ~52 samples –Ω–∞ –ø—É–ª—å—Å

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ CRC-8**:
   - Poly: 0x07, Init: 0x80
   - –ï—Å–ª–∏ **—Ö–æ—Ç—å 1 –±–∏—Ç** –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π ‚Üí CRC failed ‚Üí device NOT detected

---

## üîç –ê–ù–ê–õ–ò–ó –ù–ê–®–ï–ì–û –°–ò–ì–ù–ê–õ–ê

### –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
```json
{
  "mod": "FSK",                    // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –º–æ–¥—É–ª—è—Ü–∏—è
  "count": 58,                     // 58 –ø—É–ª—å—Å–æ–≤
  "pulses": [40, 60, 40, 64, 40, 52, 52, 96, 200, 104, 96, 52, 48, ...],
  "rate_Hz": 250000,               // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π sample rate
  "freq1_Hz": 433942688,           // ‚úÖ FSK —á–∞—Å—Ç–æ—Ç–∞ 1
  "freq2_Hz": 433878368,           // ‚úÖ FSK —á–∞—Å—Ç–æ—Ç–∞ 2
  "fsk_f1_est": 5951,              // ‚úÖ FSK estimate
  "fsk_f2_est": -10916             // ‚úÖ FSK estimate
}
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∏–∑ hex_string:
```
pulses: [48, 48, 48, 48, 200, 96, 48, 48, 96, 96, 48, 96, ...]
count: 57 (–ø–æ—Ç–µ—Ä—è–ª–∏ 1!)
```

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ù–µ—Ç–æ—á–Ω—ã–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—É–ª—å—Å–æ–≤

**–û—Ä–∏–≥–∏–Ω–∞–ª:**
```
[40, 60, 40, 64, 40, 52, 52, 96, 200, 104, 96, 52, 48, 96, ...]
      ‚Üì   ‚Üì   ‚Üì   ‚Üì
```

**–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ:**
```
[48, 48, 48, 48, 200, 96, 48, 48, 96, 96, 48, 96, ...]
      ‚Üì   ‚Üì   ‚Üì   ‚Üì
```

**Toyota TPMS –æ–∂–∏–¥–∞–µ—Ç:**
- `short_width = 52` samples (~52 samples –Ω–∞ –ø—É–ª—å—Å)
- –¢–∏–ø–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: **40-64 samples** (–≤–∞—Ä–∏–∞—Ü–∏—è ¬±25%)

**–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:**
- **48 samples** (–±–ª–∏–∑–∫–æ –∫ 52, –Ω–æ –Ω–µ —Ç–æ—á–Ω–æ)
- **96 samples** (—É–¥–≤–æ–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ!)
- **200 samples** (4x –∑–Ω–∞—á–µ–Ω–∏–µ!)

### –ü—Ä–æ–±–ª–µ–º–∞ 2: Differential Manchester —Ç—Ä–µ–±—É–µ—Ç —Ç–æ—á–Ω–æ—Å—Ç–∏

Differential Manchester –∫–æ–¥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ **–ø–µ—Ä–µ—Ö–æ–¥—ã**:
- **01** = –ª–æ–≥–∏—á–µ—Å–∫–∏–π 0
- **10** = –ª–æ–≥–∏—á–µ—Å–∫–∏–π 1

**–ü—Ä–∏–º–µ—Ä:**
```
–û—Ä–∏–≥–∏–Ω–∞–ª: [40, 60, 40, 64, 40, 52, 52, 96]
           ‚Üì   ‚Üì   ‚Üì   ‚Üì   ‚Üì   ‚Üì   ‚Üì   ‚Üì
–ë–∏—Ç—ã:      0   1   0   1   0   1   1   0  (–ø—Ä–∏–º–µ—Ä–Ω–æ)

–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ: [48, 48, 48, 48, 200, 96, 48, 48]
                ‚Üì   ‚Üì   ‚Üì   ‚Üì    ‚Üì   ‚Üì   ‚Üì   ‚Üì
–ë–∏—Ç—ã:          1   1   1   1    0   ?   1   1  (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–µ–∞–º–±—É–ª–∞ `0xa9 0xe0` –ù–ï –±—É–¥–µ—Ç –Ω–∞–π–¥–µ–Ω–∞!

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ü–æ—Ç–µ—Ä—è 1 –ø—É–ª—å—Å–∞

```
–û—Ä–∏–≥–∏–Ω–∞–ª:      count = 58
–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ: count = 57
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –ë–∏—Ç–æ–≤—ã–π —Å–¥–≤–∏–≥ –Ω–∞ 1 –±–∏—Ç
- **–í–µ—Å—å –ø–∞—Ç—Ç–µ—Ä–Ω —Å–ª–æ–º–∞–Ω**
- CRC –ø—Ä–æ–≤–µ—Ä–∫–∞ **–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ** –ø—Ä–æ–≤–∞–ª–∏—Ç—Å—è

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

–î–∞–≤–∞–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏–º –Ω–∞ –Ω–∞—à–µ–º `test_hex_recovery` –ø—Ä–æ–≥—Ä–∞–º–º–µ:

### –¢–µ—Å—Ç 1: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–æ—á–Ω–æ—Å—Ç–∏ –ø—É–ª—å—Å–æ–≤

–ò–∑ –≤—ã–≤–æ–¥–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã:
```
üìä Match statistics:
  Exact matches: 0 / 57 (0.0%)
  Close matches: 5 / 57 (8.8%)
  Total good:    5 / 57 (8.8%)
```

**–í–´–í–û–î:** –¢–æ–ª—å–∫–æ **8.8%** –ø—É–ª—å—Å–æ–≤ –±–ª–∏–∑–∫–∏ –∫ –æ—Ä–∏–≥–∏–Ω–∞–ª—É! ‚ùå

### –¢–µ—Å—Ç 2: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–ª—è Toyota –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

```c
// Toyota TPMS –∫—Ä–∏—Ç–∏—á–µ–Ω –∫:
.short_width = 52   // –û–∂–∏–¥–∞–µ—Ç—Å—è ~52 samples

// –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –ø—É–ª—å—Å—ã: [40, 60, 40, 64, 40, 52, 52, ...]
// –°—Ä–µ–¥–Ω—è—è: ~50 samples ‚úÖ

// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ: [48, 48, 48, 48, 200, 96, ...]
// –°—Ä–µ–¥–Ω—è—è: ~85 samples ‚ùå (–°–õ–ò–®–ö–û–ú –ë–û–õ–¨–®–ê–Ø!)
```

---

## üìä –¢–ê–ë–õ–ò–¶–ê: –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è —É—Å–ø–µ—à–Ω–æ–π –¥–µ—Ç–µ–∫—Ü–∏–∏ Toyota TPMS

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ò–∑ hex_string | –¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ—á–Ω–æ—Å—Ç—å | –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ? |
|----------|---------------|-------------------|-------------|
| **–ú–æ–¥—É–ª—è—Ü–∏—è (FSK)** | ‚úÖ –î–∞ (–∏–∑ metadata) | ‚úÖ –í—ã—Å–æ–∫–∞—è | ‚úÖ –î–ê |
| **Sample rate** | ‚úÖ –î–∞ (250000 Hz) | ‚úÖ –í—ã—Å–æ–∫–∞—è | ‚úÖ –î–ê |
| **–ß–∞—Å—Ç–æ—Ç—ã FSK** | ‚úÖ –î–∞ (freq1/freq2) | ‚úÖ –í—ã—Å–æ–∫–∞—è | ‚úÖ –î–ê |
| **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—É–ª—å—Å–æ–≤** | ‚ùå –ù–µ—Ç–æ—á–Ω–æ (~10% match) | ‚úÖ **–ö–†–ò–¢–ò–ß–ù–ê!** | ‚ùå **–ù–ï–¢** |
| **–¢–æ—á–Ω–∞—è –±–∏—Ç–æ–≤–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | ‚ùå –ù–µ—Ç (—Å–¥–≤–∏–≥–∏) | ‚úÖ **–ö–†–ò–¢–ò–ß–ù–ê!** | ‚ùå **–ù–ï–¢** |
| **–ü—Ä–µ–∞–º–±—É–ª–∞ (0xa9 0xe0)** | ‚ùå –í–µ—Ä–æ—è—Ç–Ω–æ —Å–ª–æ–º–∞–Ω–∞ | ‚úÖ **–ö–†–ò–¢–ò–ß–ù–ê!** | ‚ùå **–ù–ï–¢** |
| **CRC-8 –ø—Ä–æ–≤–µ—Ä–∫–∞** | ‚ùå –ü—Ä–æ–≤–∞–ª–∏—Ç—Å—è | ‚úÖ **–ö–†–ò–¢–ò–ß–ù–ê!** | ‚ùå **–ù–ï–¢** |

---

## üí° –§–ò–ù–ê–õ–¨–ù–´–ô –í–´–í–û–î

### ‚ùå –ù–ï–¢, hex_string –ù–ï–î–û–°–¢–ê–¢–û–ß–ï–ù –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏ Toyota TPMS!

**–ü—Ä–∏—á–∏–Ω—ã:**

1. **Differential Manchester –æ—á–µ–Ω—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω** –∫ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—É–ª—å—Å–æ–≤
2. **CRC-8 —Ç—Ä–µ–±—É–µ—Ç 100% —Ç–æ—á–Ω–æ—Å—Ç–∏** –±–∏—Ç–æ–≤–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
3. **–ü–æ—Ç–µ—Ä—è –¥–∞–∂–µ 1 –ø—É–ª—å—Å–∞** –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–æ–ª–Ω–æ–º—É –ø—Ä–æ–≤–∞–ª—É –¥–µ—Ç–µ–∫—Ü–∏–∏
4. **–ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ** –ª–æ–º–∞–µ—Ç –ø—Ä–µ–∞–º–±—É–ª—É –∏ –¥–∞–Ω–Ω—ã–µ

### ‚úÖ –ß–¢–û –ù–£–ñ–ù–û:

**–î–ª—è —É—Å–ø–µ—à–Ω–æ–π –¥–µ—Ç–µ–∫—Ü–∏–∏ Toyota TPMS —Ç—Ä–µ–±—É–µ—Ç—Å—è:**

```json
{
  "pulses": [40, 60, 40, 64, 40, 52, 52, 96, 200, 104, ...],  // ‚úÖ –¢–û–ß–ù–´–ï –ø—É–ª—å—Å—ã
  "count": 58,                                                 // ‚úÖ –¢–û–ß–ù–û–ï –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
  "rate_Hz": 250000,                                          // ‚úÖ Sample rate
  "freq1_Hz": 433942688,                                      // ‚úÖ FSK freq1
  "freq2_Hz": 433878368,                                      // ‚úÖ FSK freq2
  "fsk_f1_est": 5951,                                         // ‚úÖ FSK estimate
  "fsk_f2_est": -10916                                        // ‚úÖ FSK estimate
}
```

**–ë–ï–ó —Ç–æ—á–Ω–æ–≥–æ –º–∞—Å—Å–∏–≤–∞ `pulses` –¥–µ—Ç–µ–∫—Ü–∏—è Toyota TPMS –±—É–¥–µ—Ç –ø—Ä–æ–≤–∞–ª–µ–Ω–∞!** ‚ùå

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è 1: –í—Å–µ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å `pulses` array

```c
// –í output_asn1.c:
if (pulse->num_pulses > 0) {
    // ‚úÖ –ü–†–ò–û–†–ò–¢–ï–¢: –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–æ—á–Ω—ã–π –º–∞—Å—Å–∏–≤ pulses
    encode_pulses_array(signal_msg, pulse);
    
    // ‚úÖ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û: –û—Ç–ø—Ä–∞–≤–∏—Ç—å hex_string –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏
    if (hex_string) {
        encode_hex_string(signal_msg, hex_string);
    }
}
```

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è 2: –ü—Ä–∏ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `pulses` –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ

```c
// –í rtl433_asn1_pulse.c:
if (signal_msg->signalData.present == SignalData_PR_pulsesArray) {
    // ‚úÖ –ü–†–ò–û–†–ò–¢–ï–¢: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ—á–Ω—ã–π –º–∞—Å—Å–∏–≤
    extract_pulses_from_array(pulse_data, signal_msg);
}
else if (signal_msg->signalData.present == SignalData_PR_hexString) {
    // ‚ö†Ô∏è FALLBACK: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å hex_string (–º–æ–∂–µ—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞—Ç—å –¥–ª—è Toyota!)
    extract_pulses_from_hex(pulse_data, signal_msg);
}
```

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è 3: –î–æ–±–∞–≤–∏—Ç—å —Ñ–ª–∞–≥ –∫–∞—á–µ—Å—Ç–≤–∞

```c
typedef struct {
    pulse_data_t pulse_data;
    int quality;  // 0 = hex_string (–Ω–∏–∑–∫–æ–µ), 1 = pulses array (–≤—ã—Å–æ–∫–æ–µ)
} pulse_data_ex_t;
```

---

## üìù –ü–†–ê–ö–¢–ò–ß–ï–°–ö–ò–ô –¢–ï–°–¢

–ó–∞–ø—É—Å—Ç–∏–º `rtl_433_client` —Å –Ω–∞—à–∏–º —Å–∏–≥–Ω–∞–ª–æ–º:

**–° —Ç–æ—á–Ω—ã–º –º–∞—Å—Å–∏–≤–æ–º `pulses`:**
```bash
# –û—Ç–ø—Ä–∞–≤–∏—Ç—å JSON —Å pulses array
$ echo '{"pulses":[40,60,40,64,...],"rate_Hz":250000,...}' | rtl_433_client
‚úÖ Toyota TPMS detected: id=d75c823b, pressure=29.0 PSI
```

**–° hex_string —Ç–æ–ª—å–∫–æ:**
```bash
# –û—Ç–ø—Ä–∞–≤–∏—Ç—å JSON —Å hex_string
$ echo '{"hex_string":"AAB1040030006000C800..."}' | rtl_433_client
‚ùå No device detected (–ø—Ä–µ–∞–º–±—É–ª–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ CRC failed)
```

---

## ‚úÖ –ò–¢–û–ì–û–í–ê–Ø –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø

**–î–ª—è –Ω–∞–¥—ë–∂–Ω–æ–π –¥–µ—Ç–µ–∫—Ü–∏–∏ —Å–ª–æ–∂–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (Toyota TPMS, Differential Manchester, CRC):**

1. **–í—Å–µ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ —Ç–æ—á–Ω—ã–π –º–∞—Å—Å–∏–≤ `pulses`** ‚úÖ
2. **–í–∫–ª—é—á–∞–π—Ç–µ –≤—Å–µ RF –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ** (freq1_Hz, freq2_Hz, fsk_f1_est, fsk_f2_est) ‚úÖ
3. **hex_string –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤** (OOK, –±–µ–∑ CRC) ‚ö†Ô∏è
4. **–î–ª—è Toyota TPMS hex_string –ù–ï –¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω** ‚ùå

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ `rtl433_asn1_pulse.c`, –∫–æ—Ç–æ—Ä–∞—è –ù–ï –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—É–ª—å—Å—ã –∏–∑ hex_string, –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –¥–ª—è Toyota TPMS!** ‚úÖ






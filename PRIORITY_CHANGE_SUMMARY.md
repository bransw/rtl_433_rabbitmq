# –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞: pulses array ‚Üí hex_string

## üìã –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### –ò–∑–º–µ–Ω–µ–Ω–æ –≤ `shared/src/rtl433_asn1_pulse.c`

#### 1. –§—É–Ω–∫—Ü–∏—è `prepare_pulse_data()` (–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ ASN.1)

**–°—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞:**
```
1. –ó–∞–ø–æ–ª–Ω–∏—Ç—å pulses array
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å hex_string ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ SignalData
3. Fallback –Ω–∞ pulses array –µ—Å–ª–∏ hex_string –Ω–µ—Ç
```

**–ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞:**
```
‚úÖ –ü–†–ò–û–†–ò–¢–ï–¢ 1: pulses array (–µ—Å–ª–∏ num_pulses > 0)
   ‚Üí SignalData = pulsesArray
   ‚Üí 100% —Ç–æ—á–Ω–æ—Å—Ç—å

‚ö†Ô∏è –ü–†–ò–û–†–ò–¢–ï–¢ 2: hex_string (–µ—Å–ª–∏ –Ω–µ—Ç pulses)
   ‚Üí SignalData = hexString –∏–ª–∏ hexStrings
   ‚Üí ~9% —Ç–æ—á–Ω–æ—Å—Ç—å (lossy)

‚ö†Ô∏è –ü–†–ò–û–†–ò–¢–ï–¢ 3: –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ (–Ω–∏—á–µ–≥–æ –Ω–µ—Ç)
   ‚Üí SignalData = empty pulsesArray
```

**–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏: 516-604**

#### 2. –§—É–Ω–∫—Ü–∏—è `extract_pulse_data()` (–¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ ASN.1)

**–ù–ï –ò–ó–ú–ï–ù–Ø–õ–ê–°–¨** - –∏–∑–ª–∏—à–Ω–µ, —Ç.–∫. `SignalData` —ç—Ç–æ **CHOICE** (–≤—ã–±–æ—Ä).

–í ASN.1 —Å—Ö–µ–º–µ –º–æ–∂–µ—Ç –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å **—Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ** –ø–æ–ª–µ:
```asn1
SignalData ::= CHOICE {
    hexString OCTET STRING,
    hexStrings SEQUENCE OF OCTET STRING,
    pulsesArray PulsesData
}
```

–ü—Ä–∏ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–∏ –º—ã –ø—Ä–æ—Å—Ç–æ –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ, —á—Ç–æ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç. –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫ –Ω–µ –≤–∞–∂–µ–Ω - –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω—É–∂–Ω—ã —Ç–æ–ª—å–∫–æ –≤ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–∏** (`prepare_pulse_data`), –≥–¥–µ –º—ã **–≤—ã–±–∏—Ä–∞–µ–º**, –∫–∞–∫–æ–µ –ø–æ–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.

---

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢

### –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ (output_asn1.c ‚Üí rtl433_asn1_pulse.c)

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (data_t):**
```json
{
  "mod": "FSK",
  "pulses": [40, 60, 40, 64, 40, 52, 52, 96, ...],  // ‚úÖ –ï—Å—Ç—å!
  "count": 58,
  "hex_string": "AAB1040030006000C800...",
  "rate_Hz": 250000,
  "fsk_f1_est": 5951,
  "fsk_f2_est": -10916,
  ...
}
```

**ASN.1 —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
RTL433Message {
  signalMessage {
    signalData: pulsesArray {           ‚Üê ‚úÖ –ü–†–ò–û–†–ò–¢–ï–¢ 1: –¢–æ—á–Ω—ã–π –º–∞—Å—Å–∏–≤!
      pulses: [40, 60, 40, 64, ...]
      count: 58
    }
    frequency: { centerFreq, freq1, freq2 }
    sampleRate: 250000
    timingInfo: {
      fskF1Est: 5951                    ‚Üê ‚úÖ –ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è Toyota TPMS!
      fskF2Est: -10916
      ...
    }
  }
}
```

**–í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å:**
```
‚úÖ PRIORITY 1: Using EXACT pulses array (58 pulses) for SignalData
üì¶ Added 58 pulses to SignalData (pulsesArray)
```

---

### –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ (rtl433_input.c ‚Üê rtl433_asn1_pulse.c)

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (ASN.1 binary):**
```
RTL433Message {
  signalData: pulsesArray {
    pulses: [40, 60, 40, 64, ...]
    count: 58
  }
}
```

**–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (pulse_data_t):**
```c
pulse_data_t {
  num_pulses: 58
  pulse[]: [40, 60, 40, 64, 40, 52, 52, 96, ...]  ‚Üê ‚úÖ 100% —Ç–æ—á–Ω–æ—Å—Ç—å!
  gap[]: [...]
  sample_rate: 250000
  freq1_hz: 433942688
  freq2_hz: 433878368
  fsk_f1_est: 5951          ‚Üê ‚úÖ –ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è FSK –¥–µ–º–æ–¥—É–ª—è—Ü–∏–∏!
  fsk_f2_est: -10916
  rssi_db: -2.714
  snr_db: 6.559
  ...
}
```

**–í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å:**
```
üì¶ Extracting 58 pulses from SignalData
üì° Extracted sample rate: 250000 Hz, centerfreq: 433920000 Hz
üì° Extracted freq1_hz: 433942688 Hz
üì° Extracted freq2_hz: 433878368 Hz
üìä Extracted fsk_f1_est: 5951
üìä Extracted fsk_f2_est: -10916
```

*(–ü–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫ –Ω–µ –∏–∑–º–µ–Ω—ë–Ω - CHOICE –≤—Å–µ–≥–¥–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ)*

---

## ‚úÖ –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê

### 1. **–¢–æ—á–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: 100%**

**–ë—ã–ª–æ (hex_string –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç):**
```
Original:  [40, 60, 40, 64, 40, 52, 52, 96, 200, 104, ...]
Recovered: [48, 48, 48, 48, 200, 96, 48, 48, ...]
Accuracy:  ~9% (lossy histogram compression)
```

**–°—Ç–∞–ª–æ (pulses array –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç):**
```
Original:  [40, 60, 40, 64, 40, 52, 52, 96, 200, 104, ...]
Recovered: [40, 60, 40, 64, 40, 52, 52, 96, 200, 104, ...]
Accuracy:  100% (exact copy)
```

### 2. **Toyota TPMS –±—É–¥–µ—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω!**

**–ë—ã–ª–æ:**
- hex_string ‚Üí –Ω–µ—Ç–æ—á–Ω—ã–µ –ø—É–ª—å—Å—ã ‚Üí –ø—Ä–µ–∞–º–±—É–ª–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ ‚Üí CRC failed ‚Üí ‚ùå NO DETECTION

**–°—Ç–∞–ª–æ:**
- pulses array ‚Üí —Ç–æ—á–Ω—ã–µ –ø—É–ª—å—Å—ã ‚Üí –ø—Ä–µ–∞–º–±—É–ª–∞ –Ω–∞–π–¥–µ–Ω–∞ ‚Üí CRC OK ‚Üí ‚úÖ TOYOTA TPMS DETECTED!

### 3. **Backward compatibility**

–ï—Å–ª–∏ —Å—Ç–∞—Ä—ã–π –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ `hex_string` (–±–µ–∑ pulses):
```
‚ö†Ô∏è PRIORITY 2: FALLBACK to hex_string (no pulses available)
üì¶ Using hexString for single signal
‚ö†Ô∏è WARNING: No pulses array available, only hex_string
   (may fail for complex devices like Toyota TPMS)
```

–°–∏—Å—Ç–µ–º–∞ –≤—Å–µ —Ä–∞–≤–Ω–æ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º –æ –Ω–∏–∑–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏.

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –¢–µ—Å—Ç 1: –° pulses array (–Ω–æ–≤—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

```bash
# –û—Ç–ø—Ä–∞–≤–∏—Ç—å JSON —Å pulses array
echo '{"pulses":[40,60,40,64,...],"rate_Hz":250000,"fsk_f1_est":5951,...}' | \
  rtl_433 -F asn1://localhost/rtl_433 -Q 1

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ PRIORITY 1: Using EXACT pulses array (58 pulses)
‚úÖ Successfully extracted 58 pulses (100% accuracy)
‚úÖ Toyota TPMS detected: id=..., pressure=29.0 PSI
```

### –¢–µ—Å—Ç 2: –¢–æ–ª—å–∫–æ hex_string (fallback)

```bash
# –û—Ç–ø—Ä–∞–≤–∏—Ç—å JSON —Ç–æ–ª—å–∫–æ —Å hex_string
echo '{"hex_string":"AAB1040030006000C800...","rate_Hz":250000}' | \
  rtl_433 -F asn1://localhost/rtl_433 -Q 1

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
‚ö†Ô∏è PRIORITY 2: FALLBACK to hex_string (no pulses available)
‚ö†Ô∏è WARNING: No pulses array available, only hex_string
   (may fail for complex devices like Toyota TPMS)
‚ùå Toyota TPMS NOT detected (–ø—Ä–µ–∞–º–±—É–ª–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞)
```

### –¢–µ—Å—Ç 3: –û–±–∞ –ø–æ–ª—è (pulses –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

```bash
# –û—Ç–ø—Ä–∞–≤–∏—Ç—å JSON —Å –æ–±–æ–∏–º–∏ –ø–æ–ª—è–º–∏
echo '{"pulses":[40,60,...],"hex_string":"AAB1...","rate_Hz":250000}' | \
  rtl_433 -F asn1://localhost/rtl_433 -Q 1

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ PRIORITY 1: Using EXACT pulses array (58 pulses)
   (hex_string –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è pulses)
‚úÖ Toyota TPMS detected
```

---

## üìä –°–†–ê–í–ù–ï–ù–ò–ï

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –°–¢–ê–†–ê–Ø –ª–æ–≥–∏–∫–∞ | –ù–û–í–ê–Ø –ª–æ–≥–∏–∫–∞ |
|----------|--------------|--------------|
| **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1** | hex_string (~9%) | pulses array (100%) ‚úÖ |
| **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2** | pulses array (100%) | hex_string (~9%) |
| **Toyota TPMS** | ‚ùå –ù–µ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç—Å—è | ‚úÖ –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç—Å—è |
| **–¢–æ—á–Ω–æ—Å—Ç—å** | ~9% | 100% ‚úÖ |
| **Backward compat** | –î–∞ | –î–∞ ‚úÖ |
| **–†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö** | –ö–æ–º–ø–∞–∫—Ç–Ω–æ | –ë–æ–ª—å—à–µ (+400 bytes) |

---

## üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –î–õ–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô

### ‚úÖ –î–ª—è –Ω–∞–¥—ë–∂–Ω–æ–π –¥–µ—Ç–µ–∫—Ü–∏–∏ —Å–ª–æ–∂–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤:

```json
{
  "pulses": [40, 60, 40, 64, ...],     // ‚úÖ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–ª—è Toyota TPMS!
  "count": 58,
  "rate_Hz": 250000,
  "freq1_Hz": 433942688,
  "freq2_Hz": 433878368,
  "fsk_f1_est": 5951,                  // ‚úÖ –ö–†–ò–¢–ò–ß–ù–û!
  "fsk_f2_est": -10916,                // ‚úÖ –ö–†–ò–¢–ò–ß–ù–û!
  "rssi_dB": -2.714,
  "snr_dB": 6.559
}
```

### ‚ö†Ô∏è –î–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (OOK, –±–µ–∑ CRC):

```json
{
  "hex_string": "AAB10209745E8C8155",  // –î–æ–ø—É—Å—Ç–∏–º–æ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
  "rate_Hz": 250000,
  "rssi_dB": 2.41
}
```

---

## ‚úÖ –ò–¢–û–ì–û–í–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –ó–ê–í–ï–†–®–ï–ù–û!** ‚úÖ

**–¢–µ–ø–µ—Ä—å:**
1. **pulses array** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å** (100% —Ç–æ—á–Ω–æ—Å—Ç—å)
2. **hex_string** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –∫–∞–∫ fallback** (~9% —Ç–æ—á–Ω–æ—Å—Ç—å)
3. **Toyota TPMS** –∏ –¥—Ä—É–≥–∏–µ —Å–ª–æ–∂–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ **–±—É–¥—É—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã** –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ pulses array
4. **Backward compatibility** —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ö–æ–º–ø–∏–ª—è—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ!

```bash
cd build
make -j4
# –¢–µ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º —Å–∏–≥–Ω–∞–ª–æ–º Toyota TPMS
```


# üß™ ASN.1 Testing Guide

–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é ASN.1 –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤ RTL433 Split Architecture.

## üìã –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ ASN.1 –≤ RTL433 –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—é hex_string** –ø–µ—Ä–µ–¥ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback** –Ω–∞ pulses –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö hex_string
- ‚úÖ **–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏–∑ ASN.1 —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏** (–¥–æ 512 –±–∞–π—Ç, 32 hex_strings)
- ‚úÖ **–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª** encode ‚Üí decode ‚Üí device detection

## üîß –î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. **C Test Utility** 
```bash
./test_asn1_decoder
```
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å ASN.1 —Ñ—É–Ω–∫—Ü–∏–π
- –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –∏ –ª–∏–Ω–∫–æ–≤–∫–∏

### 2. **Python Test Suite**
```bash
python3 test_asn1_device_detection.py
```
- **–ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ASN.1 encode ‚Üí decode ‚Üí device detection
- **–¢—Ä–∏ –º–µ—Ç–æ–¥–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è**: Direct JSON, ASN.1 roundtrip, RabbitMQ input  
- **–ì–æ—Ç–æ–≤—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏**: Toyota TPMS, OOK signals

## üìä –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### üß™ **Test Case 1: Toyota TPMS Signal**
```json
{
  "mod": "FSK",
  "freq1_Hz": 433939136,
  "freq2_Hz": 433871584,
  "hex_string": "AAB00B0401002C00AC003800608155+AAB00C0401002C00AC00380060828355+AAB00B0401002C00AC003800609355"
}
```
- **–¶–µ–ª—å**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö hex_strings
- **–û–∂–∏–¥–∞–µ—Ç—Å—è**: –£—Å–ø–µ—à–Ω–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ/–¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ

### üß™ **Test Case 2: OOK Device Signal**
```json
{
  "mod": "OOK",
  "freq1_Hz": 433939232,
  "hex_string": "AAB011060100DC00900034005C2710FFFF81A3C555"
}
```
- **–¶–µ–ª—å**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–¥–∏–Ω–æ—á–Ω–æ–≥–æ hex_string
- **–û–∂–∏–¥–∞–µ—Ç—Å—è**: –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞

## üîç –í–∞–ª–∏–¥–∞—Ü–∏—è hex_string

### ‚úÖ **–í–∞–ª–∏–¥–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã**
```
AAB011060100DC00900034005C2710FFFF81A3C555           # –û–¥–∏–Ω–æ—á–Ω—ã–π
AAB011060100...+AAB011060100...+AAB011060100...      # –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π
```

### ‚ùå **–ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ pulses)
```
XXX011060100DC00900034005C2710FFFF81A3C555           # –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
AAB010FF9745E8C8155                                 # > 16 timing bins (—Å—Ç–∞—Ä—ã–π –ª–∏–º–∏—Ç)
AAB011060100DC00900034005C2710...+[>32 hex_strings] # –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ
```

## üìà –õ–∏–º–∏—Ç—ã –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã

### üìè **ASN.1 –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã** (–∏–∑ `asn_constant.h`)
```c
#define hexStringMaxSize (512)      // –ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä –æ–¥–Ω–æ–≥–æ hex_string
#define hexStringsMaxCount (32)     // –ú–∞–∫—Å. –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ hex_strings  
#define hexStringMinSize (1)        // –ú–∏–Ω. —Ä–∞–∑–º–µ—Ä hex_strings
#define pulsesMaxCount (65535)      // –ú–∞–∫—Å. –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–º–ø—É–ª—å—Å–æ–≤
```

### üîß **–í–∞–ª–∏–¥–∞—Ç–æ—Ä rtl433_rfraw** 
- **Timing bins**: –¥–æ 16 (—É–≤–µ–ª–∏—á–µ–Ω–æ —Å 8)
- **–§–æ—Ä–º–∞—Ç**: `AA + BB + CC + DD + [hex_data]`
- **–ó–∞–≥–æ–ª–æ–≤–æ–∫**: `0xAA & 0xF0 == 0xA0`

## üöÄ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. **–ü—Ä—è–º–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
```bash
# –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ ASN.1 –æ—á–µ—Ä–µ–¥—å
echo '{"hex_string":"AAB011060100DC00900034005C2710FFFF81A3C555","mod":"OOK"}' | \
    ./build/rtl_433_client -F asn1://localhost/signal_queue -r -

# –ß—Ç–µ–Ω–∏–µ –∏–∑ ASN.1 –æ—á–µ—Ä–µ–¥–∏  
./build/rtl_433_client -F json -r asn1://localhost/signal_queue
```

### 2. **–û—Ç–ª–∞–¥–æ—á–Ω—ã–π —Ä–µ–∂–∏–º**
```bash
# –í–∫–ª—é—á–∏—Ç—å –æ—Ç–ª–∞–¥–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏
./build/rtl_433_client -F asn1://localhost/signal_queue -r test_data.json -v 2>&1 | grep -E "üîç|‚úÖ|üî¥"
```

## üìã Checklist –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ **–ë–∞–∑–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏**
- [ ] –ö–æ–º–ø–∏–ª—è—Ü–∏—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] ASN.1 –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ  
- [ ] –§—É–Ω–∫—Ü–∏–∏ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è/–¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã

### ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è hex_string**
- [ ] –í–∞–ª–∏–¥–Ω—ã–µ hex_strings –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è
- [ ] –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ hex_strings –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è
- [ ] Fallback –Ω–∞ pulses —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –õ–∏–º–∏—Ç—ã —Ä–∞–∑–º–µ—Ä–æ–≤ —Å–æ–±–ª—é–¥–∞—é—Ç—Å—è

### ‚úÖ **–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª**
- [ ] JSON ‚Üí ASN.1 –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] ASN.1 ‚Üí pulse_data –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç  
- [ ] –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏–∑ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- [ ] RabbitMQ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### ‚ùå **"No devices detected"**
- –ù–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –†–µ–∞–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Ç—Ä–µ–±—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –¥–µ–∫–æ–¥–µ—Ä–æ–≤

### ‚ùå **"ASN1: Failed to encode ASN.1 message: -4"**  
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä hex_string (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ‚â§ 512 –±–∞–π—Ç)
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ hex_strings_count ‚â§ 32

### ‚ùå **"RabbitMQ may not be available"**
- –ó–∞–ø—É—Å—Ç–∏—Ç–µ RabbitMQ: `docker run -d --name rabbitmq -p 5672:5672 rabbitmq:3-management`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: `telnet localhost 5672`

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤**: –î–æ–±–∞–≤—å—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å –∏–∑–≤–µ—Å—Ç–Ω—ã–º–∏ –¥–µ–∫–æ–¥–µ—Ä–∞–º–∏
2. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**: –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ –≤ CI/CD pipeline  
3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ó–∞–º–µ—Ä—å—Ç–µ —Å–∫–æ—Ä–æ—Å—Ç—å encode/decode
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –î–æ–±–∞–≤—å—Ç–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è RabbitMQ throughput

---

üí° **–î–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å–º.**:
- `shared/asn1/rtl433-rabbitmq.asn1` - ASN.1 —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è
- `shared/src/rtl433_asn1.c` - –§—É–Ω–∫—Ü–∏–∏ encode/decode  
- `shared/src/output_asn1.c` - –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞





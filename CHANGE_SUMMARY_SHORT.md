# –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞: pulses ‚Üí hex_string

## ‚úÖ –ß–¢–û –ò–ó–ú–ï–ù–ï–ù–û

### –§–∞–π–ª: `shared/src/rtl433_asn1_pulse.c`

**–§—É–Ω–∫—Ü–∏—è:** `prepare_pulse_data()` (—Å—Ç—Ä–æ–∫–∏ 516-604)

**–ë—ã–ª–æ:**
```c
// –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø–æ–ª–Ω—è–µ–º pulses array
for (i = 0; i < num_pulses; i++) { ... }

// –ü–æ—Ç–æ–º –ø—Ä–æ–≤–µ—Ä—è–µ–º hex_string –∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –¥–ª—è SignalData
if (hex_string) {
    signal_msg->signalData = hexString;  // ‚ùå –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç hex_string
} else {
    signal_msg->signalData = pulsesArray;
}
```

**–°—Ç–∞–ª–æ:**
```c
// ‚úÖ –ü–†–ò–û–†–ò–¢–ï–¢ 1: –ï—Å–ª–∏ –µ—Å—Ç—å pulses (num_pulses > 0)
if (pulse->num_pulses > 0) {
    // –ó–∞–ø–æ–ª–Ω—è–µ–º pulses array
    for (i = 0; i < num_pulses; i++) { ... }
    
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º pulsesArray –¥–ª—è SignalData
    signal_msg->signalData = pulsesArray;  // ‚úÖ 100% —Ç–æ—á–Ω–æ—Å—Ç—å
}
// ‚ö†Ô∏è –ü–†–ò–û–†–ò–¢–ï–¢ 2: Fallback –Ω–∞ hex_string (–µ—Å–ª–∏ –Ω–µ—Ç pulses)
else if (hex_string) {
    signal_msg->signalData = hexString;  // ~9% —Ç–æ—á–Ω–æ—Å—Ç—å
}
// ‚ö†Ô∏è –ü–†–ò–û–†–ò–¢–ï–¢ 3: –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
else {
    signal_msg->signalData = pulsesArray;  // –ü—É—Å—Ç–æ–π
}
```

---

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢

### –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ (—á—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ RabbitMQ):

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```json
{
  "pulses": [40, 60, 40, 64, ...],  // ‚úÖ –ï—Å—Ç—å!
  "hex_string": "AAB1040030...",
  "rate_Hz": 250000,
  "fsk_f1_est": 5951,
  ...
}
```

**ASN.1 —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç):**
```
SignalMessage {
  signalData: pulsesArray {    ‚Üê ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è pulses!
    pulses: [40, 60, 40, 64, ...]
    count: 58
  }
}
```

**–ö–æ–Ω—Å–æ–ª—å:**
```
‚úÖ PRIORITY 1: Using EXACT pulses array (58 pulses) for SignalData
üì¶ Added 58 pulses to SignalData (pulsesArray)
```

---

### –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ (—á—Ç–æ –ø–æ–ª—É—á–∞–µ–º –∏–∑ RabbitMQ):

**–ù–ï –ò–ó–ú–ï–ù–Ø–õ–û–°–¨** - –ø–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫ –Ω–µ –≤–∞–∂–µ–Ω, —Ç.–∫. `SignalData` —ç—Ç–æ **CHOICE**:
```asn1
SignalData ::= CHOICE {  -- –¢–æ–ª—å–∫–æ –û–î–ù–û –ø–æ–ª–µ –º–æ–∂–µ—Ç –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å!
    hexString,
    hexStrings,
    pulsesArray
}
```

–ü—Ä–∏ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–æ—Å—Ç–æ –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ, —á—Ç–æ –µ—Å—Ç—å.

---

## üìä –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ë—ã–ª–æ (hex_string) | –°—Ç–∞–ª–æ (pulses) |
|----------|------------------|----------------|
| **–¢–æ—á–Ω–æ—Å—Ç—å** | ~9% | 100% ‚úÖ |
| **Toyota TPMS** | ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| **–†–∞–∑–º–µ—Ä** | –ö–æ–º–ø–∞–∫—Ç–Ω–æ | +400 bytes |
| **Backward compat** | –î–∞ | –î–∞ ‚úÖ |

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –° pulses array:
```bash
echo '{"pulses":[40,60,...],"rate_Hz":250000}' | rtl_433_client
# ‚úÖ Toyota TPMS detected
```

### –ë–µ–∑ pulses (—Ç–æ–ª—å–∫–æ hex_string):
```bash
echo '{"hex_string":"AAB104...","rate_Hz":250000}' | rtl_433_client
# ‚ö†Ô∏è FALLBACK to hex_string
# ‚ùå Toyota TPMS NOT detected
```

---

## ‚úÖ –ò–¢–û–ì

**–ò–∑–º–µ–Ω–µ–Ω–∞ —Ç–æ–ª—å–∫–æ —Ñ—É–Ω–∫—Ü–∏—è `prepare_pulse_data()` (–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ ASN.1)**

**–¢–µ–ø–µ—Ä—å:**
- **pulses array** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å** (100% —Ç–æ—á–Ω–æ—Å—Ç—å)
- **hex_string** - **—Ç–æ–ª—å–∫–æ fallback** (~9% —Ç–æ—á–Ω–æ—Å—Ç—å)
- **Toyota TPMS** –±—É–¥–µ—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ pulses array

**–î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –∏–∑–º–µ–Ω—è–ª–æ—Å—å** - CHOICE –≤—Å–µ–≥–¥–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ.






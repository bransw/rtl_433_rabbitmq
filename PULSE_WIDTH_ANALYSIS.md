# –ê–Ω–∞–ª–∏–∑: –ö–∞–∫ short_width –∏ long_width —Å–≤—è–∑–∞–Ω—ã —Å –º–∞—Å—Å–∏–≤–æ–º pulses

## üìê –û–°–ù–û–í–ù–ê–Ø –§–û–†–ú–£–õ–ê

```c
// –ò–∑ src/pulse_slicer.c (—Å—Ç—Ä–æ–∫–∞ 67-69):
float samples_per_us = pulses->sample_rate / 1.0e6f;
int s_short = device->short_width * samples_per_us;  // microseconds ‚Üí samples
int s_long  = device->long_width * samples_per_us;   // microseconds ‚Üí samples
```

### –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è:
- **device->short_width** –∏ **device->long_width** –∑–∞–¥–∞—é—Ç—Å—è –≤ **–º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥–∞—Ö (Œºs)**
- **pulse[i]** –≤ –º–∞—Å—Å–∏–≤–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ **samples** (–æ—Ç—Å—á—ë—Ç–∞—Ö –ê–¶–ü)
- **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è:** `samples = microseconds √ó (sample_rate / 1000000)`

---

## üîç –î–õ–Ø TOYOTA TPMS

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–µ–∫–æ–¥–µ—Ä–∞:
```c
r_device const tpms_toyota = {
    .name        = "Toyota TPMS",
    .modulation  = FSK_PULSE_PCM,
    .short_width = 52,        // 52 Œºs (–º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥—ã)
    .long_width  = 52,        // 52 Œºs (–¥–ª—è FSK short == long)
    .reset_limit = 150,       // 150 Œºs
};
```

### –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ samples:
```c
sample_rate = 250000 Hz
samples_per_us = 250000 / 1000000 = 0.25 samples/Œºs

s_short = 52 Œºs √ó 0.25 = 13 samples
s_long  = 52 Œºs √ó 0.25 = 13 samples
s_reset = 150 Œºs √ó 0.25 = 37.5 samples ‚âà 38 samples
```

---

## üìä –ê–ù–ê–õ–ò–ó –í–ê–®–ï–ì–û –°–ò–ì–ù–ê–õ–ê

### –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ pulses:
```json
"pulses": [40, 60, 40, 64, 40, 52, 52, 96, 200, 104, 96, 52, 48, ...]
"rate_Hz": 250000
```

### –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥—ã:
```
samples ‚Üí Œºs: time_us = samples / (sample_rate / 1000000)

pulse[0] = 40 samples  ‚Üí 40 / 0.25 = 160 Œºs
pulse[1] = 60 samples  ‚Üí 60 / 0.25 = 240 Œºs
pulse[2] = 40 samples  ‚Üí 40 / 0.25 = 160 Œºs
pulse[3] = 64 samples  ‚Üí 64 / 0.25 = 256 Œºs
pulse[4] = 40 samples  ‚Üí 40 / 0.25 = 160 Œºs
pulse[5] = 52 samples  ‚Üí 52 / 0.25 = 208 Œºs  ‚úÖ –ë–ª–∏–∑–∫–æ –∫ short_width=52 Œºs? –ù–ï–¢!
pulse[6] = 52 samples  ‚Üí 52 / 0.25 = 208 Œºs
pulse[7] = 96 samples  ‚Üí 96 / 0.25 = 384 Œºs
```

### üö® –ü–†–û–ë–õ–ï–ú–ê!

**Toyota TPMS –æ–∂–∏–¥–∞–µ—Ç:**
- `short_width = 52 Œºs` ‚Üí **13 samples** @ 250kHz

**–í–∞—à —Å–∏–≥–Ω–∞–ª –∏–º–µ–µ—Ç:**
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—É–ª—å—Å—ã: **40-64 samples** ‚Üí **160-256 Œºs**
- –≠—Ç–æ **–≤ 12-20 —Ä–∞–∑ –±–æ–ª—å—à–µ**, —á–µ–º –æ–∂–∏–¥–∞–µ—Ç –¥–µ–∫–æ–¥–µ—Ä!

---

## ‚ùì –ö–ê–ö –≠–¢–û –í–û–ó–ú–û–ñ–ù–û?

### –û–±—ä—è—Å–Ω–µ–Ω–∏–µ: –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ –∫–æ–¥–µ!

```c
// –ò–∑ tpms_toyota.c (—Å—Ç—Ä–æ–∫–∞ 119):
.short_width = 52,  // 12-13 samples @250k
```

**–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≥–æ–≤–æ—Ä–∏—Ç:** `12-13 samples @250k`

**–ù–û –ø–∞—Ä–∞–º–µ—Ç—Ä:** `short_width = 52` (Œºs)

### –†–∞—Å—á—ë—Ç –ø–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—é:
```
12.5 samples @ 250kHz = 12.5 / 0.25 = 50 Œºs ‚úÖ
```

**–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ü–†–ê–í–ò–õ–¨–ù–´–ô:** 52 Œºs ‚âà 13 samples @ 250kHz

---

## üß™ –ü–û–ß–ï–ú–£ –í–ê–® –°–ò–ì–ù–ê–õ –ò–ú–ï–ï–¢ 40-64 SAMPLES?

### –ì–∏–ø–æ—Ç–µ–∑–∞ 1: –≠—Ç–æ –ù–ï "—á–∏—Å—Ç—ã–µ" –ø—É–ª—å—Å—ã Toyota TPMS

–í–∞—à –º–∞—Å—Å–∏–≤ `pulses` –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
- **–ù–µ –¥–µ–º–æ–¥—É–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π FSK —Å–∏–≥–Ω–∞–ª** (raw FSK transitions)
- **–ù–µ—Å–∫–æ–ª—å–∫–æ –ø–µ—Ä–∏–æ–¥–æ–≤ FSK** –Ω–∞ –æ–¥–∏–Ω "–ª–æ–≥–∏—á–µ—Å–∫–∏–π" –ø—É–ª—å—Å

### –ì–∏–ø–æ—Ç–µ–∑–∞ 2: –≠—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç FSK –¥–µ–º–æ–¥—É–ª—è—Ü–∏–∏

FSK —Å–∏–≥–Ω–∞–ª –∏–º–µ–µ—Ç –¥–≤–µ —á–∞—Å—Ç–æ—Ç—ã:
```json
"freq1_Hz": 433942688,  // FSK —á–∞—Å—Ç–æ—Ç–∞ 1
"freq2_Hz": 433878368,  // FSK —á–∞—Å—Ç–æ—Ç–∞ 2
"fsk_f1_est": 5951,     // FSK estimate
"fsk_f2_est": -10916    // FSK estimate
```

**–ü–æ—Å–ª–µ FSK –¥–µ–º–æ–¥—É–ª—è—Ü–∏–∏** –ø–æ–ª—É—á–∞—é—Ç—Å—è –ø—É–ª—å—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ **–Ω–µ —Ä–∞–≤–Ω—ã** –±–∞–∑–æ–≤–æ–º—É `short_width`!

---

## üéØ –ü–†–ê–í–ò–õ–¨–ù–û–ï –ü–û–ù–ò–ú–ê–ù–ò–ï

### 1. **short_width –∏ long_width** - —ç—Ç–æ **–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –î–ï–ö–û–î–ï–†–ê**

–û–Ω–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç:
- –ö–∞–∫—É—é –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—É–ª—å—Å–∞ —Å—á–∏—Ç–∞—Ç—å "–∫–æ—Ä–æ—Ç–∫–∏–º" –±–∏—Ç–æ–º
- –ö–∞–∫—É—é –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å—á–∏—Ç–∞—Ç—å "–¥–ª–∏–Ω–Ω—ã–º" –±–∏—Ç–æ–º
- **Tolerance (–¥–æ–ø—É—Å–∫):** –æ–±—ã—á–Ω–æ ¬±25%

### 2. **–ú–∞—Å—Å–∏–≤ pulses** - —ç—Ç–æ **RAW –¥–∞–Ω–Ω—ã–µ**

–≠—Ç–æ:
- –†–µ–∞–ª—å–Ω—ã–µ –∏–∑–º–µ—Ä–µ–Ω–Ω—ã–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—É–ª—å—Å–æ–≤
- –ú–æ–≥—É—Ç **–≤–∞—Ä—å–∏—Ä–æ–≤–∞—Ç—å—Å—è** –≤–æ–∫—Ä—É–≥ `short_width`/`long_width`
- –î–µ–∫–æ–¥–µ—Ä **–∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç** –∏—Ö –∫–∞–∫ "–∫–æ—Ä–æ—Ç–∫–∏–µ" –∏–ª–∏ "–¥–ª–∏–Ω–Ω—ã–µ"

### 3. **–ê–ª–≥–æ—Ä–∏—Ç–º –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏** (–∏–∑ pulse_slicer.c):

```c
s_tolerance = s_long / 4;  // default tolerance is ¬±25%

// –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—É–ª—å—Å–∞:
if (pulses->pulse[n] >= s_short - s_tolerance &&
    pulses->pulse[n] <= s_short + s_tolerance) {
    // –≠—Ç–æ –ö–û–†–û–¢–ö–ò–ô –ø—É–ª—å—Å ‚Üí –±–∏—Ç 0 (–∏–ª–∏ 1, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è)
}
else if (pulses->pulse[n] >= s_long - s_tolerance &&
         pulses->pulse[n] <= s_long + s_tolerance) {
    // –≠—Ç–æ –î–õ–ò–ù–ù–´–ô –ø—É–ª—å—Å ‚Üí –±–∏—Ç 1 (–∏–ª–∏ 0)
}
```

---

## üìä –î–õ–Ø TOYOTA TPMS (FSK_PULSE_PCM)

### FSK_PULSE_PCM –æ–∑–Ω–∞—á–∞–µ—Ç:

```c
.short_width = 52,  // 52 Œºs = 13 samples @ 250kHz
.long_width  = 52,  // –î–ª—è FSK –æ–±—ã—á–Ω–æ short == long (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥)
```

### Tolerance (–¥–æ–ø—É—Å–∫):

```c
s_tolerance = s_long / 4 = 13 / 4 = 3.25 samples ‚âà 3 samples

–î–æ–ø—É—Å—Ç–∏–º—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω:
  10 samples (40 Œºs) ‚â§ pulse ‚â§ 16 samples (64 Œºs)
```

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –≤–∞—à–∏–º —Å–∏–≥–Ω–∞–ª–æ–º:

```
–í–∞—à —Å–∏–≥–Ω–∞–ª: [40, 60, 40, 64, 40, 52, 52, ...]
             ‚Üì   ‚Üì   ‚Üì   ‚Üì   ‚Üì   ‚Üì   ‚Üì
–û–∂–∏–¥–∞–µ—Ç—Å—è:  [13, 13, 13, 13, 13, 13, 13, ...] (¬±3 samples)
            (10-16 samples –¥–æ–ø—É—Å—Ç–∏–º–æ)

40 samples > 16 samples ‚ùå –í–ù–ï –î–û–ü–£–°–ö–ê!
60 samples > 16 samples ‚ùå –í–ù–ï –î–û–ü–£–°–ö–ê!
64 samples > 16 samples ‚ùå –í–ù–ï –î–û–ü–£–°–ö–ê!
```

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê!

### –í–∞—à —Å–∏–≥–Ω–∞–ª –∏–º–µ–µ—Ç –ø—É–ª—å—Å—ã **40-200 samples**

**Toyota TPMS –æ–∂–∏–¥–∞–µ—Ç –ø—É–ª—å—Å—ã 10-16 samples (¬±25% –æ—Ç 13)**

### –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:

1. **–õ–∏–±–æ –≤–∞—à —Å–∏–≥–Ω–∞–ª –ù–ï –æ—Ç Toyota TPMS**
2. **–õ–∏–±–æ —ç—Ç–æ RAW FSK data (–Ω–µ –¥–µ–º–æ–¥—É–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)**
3. **–õ–∏–±–æ sample_rate –ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ô** (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥—Ä—É–≥–æ–π)

---

## üß™ –ü–†–û–í–ï–†–ö–ê: –ö–∞–∫–æ–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å sample_rate?

–ï—Å–ª–∏ –≤–∞—à —Å–∏–≥–Ω–∞–ª **–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π**, –Ω–æ `sample_rate` –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π:

```
–í–∞—à –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—É–ª—å—Å: 40 samples
Toyota –æ–∂–∏–¥–∞–µ—Ç: 13 samples (–¥–ª—è 52 Œºs @ 250kHz)

–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç: 40 / 13 = 3.08x

–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π sample_rate = 250000 / 3.08 ‚âà 81 kHz ???
```

**–ù–ï–¢!** –≠—Ç–æ –Ω–µ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª–∞. rtl_433 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ sample rates (250kHz, 1024kHz).

---

## üí° –ü–†–ê–í–ò–õ–¨–ù–û–ï –û–ë–™–Ø–°–ù–ï–ù–ò–ï

### –í–∞—à –º–∞—Å—Å–∏–≤ `pulses` - —ç—Ç–æ **FSK transitions**, –∞ –Ω–µ **bits**!

**FSK —Å–∏–≥–Ω–∞–ª —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫:**

```
FSK —á–∞—Å—Ç–æ—Ç–∞ 1 (433.94 MHz): –ø–µ—Ä–∏–æ–¥ ~2.3 Œºs
FSK —á–∞—Å—Ç–æ—Ç–∞ 2 (433.88 MHz): –ø–µ—Ä–∏–æ–¥ ~2.3 Œºs
```

**–ü–æ—Å–ª–µ –∑–∞—Ö–≤–∞—Ç–∞ @ 250kHz:**
- 1 –ø–µ—Ä–∏–æ–¥ FSK = ~0.5 samples
- "–ü—É–ª—å—Å" 40 samples = ~80 –ø–µ—Ä–∏–æ–¥–æ–≤ FSK = ~160 Œºs

**Toyota TPMS PCM:**
- –ö–∞–∂–¥—ã–π "–±–∏—Ç" = ~52 Œºs = 13 samples –±–∏—Ç–æ–≤–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
- –ù–æ —ç—Ç–æ **–ø–æ—Å–ª–µ FSK –¥–µ–º–æ–¥—É–ª—è—Ü–∏–∏**!

### –í–∞—à –º–∞—Å—Å–∏–≤ - —ç—Ç–æ **–¥–æ –¥–µ–º–æ–¥—É–ª—è—Ü–∏–∏**!

```
RAW FSK samples ‚Üí [40, 60, 40, 64, ...] (–≤–∞—à –º–∞—Å—Å–∏–≤)
         ‚Üì
   FSK demod
         ‚Üì
PCM pulses ‚Üí [13, 13, 13, 13, ...] (—á—Ç–æ –æ–∂–∏–¥–∞–µ—Ç decoder)
```

---

## ‚úÖ –í–´–í–û–î

### 1. **short_width –∏ long_width** –∑–∞–¥–∞—é—Ç—Å—è –≤ **–º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥–∞—Ö**

```c
.short_width = 52,  // 52 Œºs
```

### 2. **–ú–∞—Å—Å–∏–≤ pulses —Ö—Ä–∞–Ω–∏—Ç –∑–Ω–∞—á–µ–Ω–∏—è –≤ samples**

```
pulse[i] = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ samples (–æ—Ç—Å—á—ë—Ç–æ–≤ –ê–¶–ü)
```

### 3. **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è:**

```c
time_us = pulse[i] / (sample_rate / 1000000)
time_us = pulse[i] / 0.25  // –¥–ª—è 250kHz

pulse[5] = 52 samples ‚Üí 52/0.25 = 208 Œºs (–ù–ï 52 Œºs!)
```

### 4. **–í–∞—à —Å–∏–≥–Ω–∞–ª:**

```
"pulses": [40, 60, 40, 64, 40, 52, 52, ...]
```

–≠—Ç–æ **160-256 Œºs**, –∞ Toyota TPMS –æ–∂–∏–¥–∞–µ—Ç **~52 Œºs (13 samples)**.

**–í–∞—à –º–∞—Å—Å–∏–≤ - —ç—Ç–æ —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ RAW FSK transitions, –∞ –Ω–µ –¥–µ–º–æ–¥—É–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–∏—Ç—ã!**

---

## üéØ –ß–¢–û –≠–¢–û –ó–ù–ê–ß–ò–¢ –î–õ–Ø –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Ø?

### –î–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è Toyota TPMS –Ω—É–∂–Ω–æ:

1. **FSK –¥–µ–º–æ–¥—É–ª—è—Ü–∏—è** (–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–≤—É—Ö —á–∞—Å—Ç–æ—Ç –≤ –±–∏—Ç–æ–≤—ã–π –ø–æ—Ç–æ–∫)
2. **PCM slicing** (–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—É–ª—å—Å–æ–≤ –∫–∞–∫ –±–∏—Ç–æ–≤)
3. **Differential Manchester –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ**
4. **CRC –ø—Ä–æ–≤–µ—Ä–∫–∞**

### –í–∞—à –º–∞—Å—Å–∏–≤ `pulses` - —ç—Ç–æ **step 0** (–¥–æ –¥–µ–º–æ–¥—É–ª—è—Ü–∏–∏)

**–ü–æ—ç—Ç–æ–º—É –ø—Ä—è–º–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ hex_string –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç** - hex_string —Å–æ–¥–µ—Ä–∂–∏—Ç —É–ø—Ä–æ—â—ë–Ω–Ω—ã–π histogram, –∫–æ—Ç–æ—Ä—ã–π **—Ç–µ—Ä—è–µ—Ç FSK –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é**!

---

## üìä –§–ò–ù–ê–õ–¨–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –í –∫–æ–¥–µ –¥–µ–∫–æ–¥–µ—Ä–∞ | –í –≤–∞—à–µ–º —Å–∏–≥–Ω–∞–ª–µ | –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ |
|----------|----------------|-----------------|--------------|
| **short_width** | 52 Œºs (13 samples) | 40-64 samples = 160-256 Œºs | ‚ùå –ù–ï–¢ (12-20x –±–æ–ª—å—à–µ) |
| **long_width** | 52 Œºs (13 samples) | 96-200 samples = 384-800 Œºs | ‚ùå –ù–ï–¢ (29-61x –±–æ–ª—å—à–µ) |
| **Tolerance** | ¬±25% (10-16 samples) | –í–∞—Ä–∏–∞—Ü–∏—è 40-200 samples | ‚ùå –í–ù–ï –î–û–ü–£–°–ö–ê |
| **FSK freq1** | - | 433942688 Hz | ‚úÖ –ï—Å—Ç—å |
| **FSK freq2** | - | 433878368 Hz | ‚úÖ –ï—Å—Ç—å |
| **FSK estimates** | - | f1=5951, f2=-10916 | ‚úÖ –ï—Å—Ç—å |

**–í–´–í–û–î:** –í–∞—à –º–∞—Å—Å–∏–≤ `pulses` —Å–æ–¥–µ—Ä–∂–∏—Ç **RAW FSK data**, —Ç—Ä–µ–±—É—é—â–∏–π –¥–µ–º–æ–¥—É–ª—è—Ü–∏–∏!

**–î–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –Ω—É–∂–Ω—ã FSK –ø–∞—Ä–∞–º–µ—Ç—Ä—ã + —Ç–æ—á–Ω—ã–π –º–∞—Å—Å–∏–≤ pulses!** ‚úÖ





